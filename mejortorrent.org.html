<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Descarregar TORRENTS</title>
        <meta charset="UTF-8">
        <meta name="referrer" content="no-referrer-when-downgrade" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <script>
           /**
           * Get HTML asynchronously
           * @param  {String}   url      The URL to get HTML from
           * @param  {Function} callback A callback funtion. Pass in "response" variable to use returned HTML.
           */
            var getHTML = function ( url, savevariable, callback ) {
                    // Feature detection
                    if ( !window.XMLHttpRequest ) return;
                    // Create new request
                    var xhr = new XMLHttpRequest();

                    // Setup callback
                    xhr.onload = function() {
                            if ( callback && typeof( callback ) === 'function' ) {
                                    callback( this.responseXML );
                            }
                    }
                    // Get the HTML
                    xhr.open( 'GET', url );
                    xhr.responseType = 'document';
                    xhr.send();

            };
            function eliminarDiacriticosEs(texto) {
                return texto
                       .normalize('NFD')
                       .replace(/([^n\u0300-\u036f]|n(?!\u0303(?![\u0300-\u036f])))[\u0300-\u036f]+/gi,"$1")
                       .normalize();
            }
            function search(){
               var mainNODE = document.getElementById("meri");
               while (mainNODE.firstChild) {
                    mainNODE.removeChild(mainNODE.firstChild);
               }
               var infoNODE = document.getElementById("info"); 
               infoNODE.innerHTML="CERCANT...tingues paciència..";
               
               var x = document.getElementById("search_input").value;
               document.getElementById("search_mejortorrent1").value="";
               var regex = /<tr[\s\S]*Peliculas/i;
               //var queryURL = "https://mejortorrent1.com/?s=";
               //var downloadURL = "https://mejortorrent1.com/descargar.php"
               var queryURL = "http://www.mejortorrent.org/secciones.php?sec=buscador&valor="
               var createdQuery = queryURL+x; 

               
               getHTML(createdQuery, "",function(response){
                   var stringui = response.documentElement.innerHTML;
                   var elements = response.getElementsByTagName('tr');
                   var arr = Array.from(elements);
                   for (var i=0; i<arr.length; i++){
                       var childNodes = arr[i].childNodes;
                       
                       if (childNodes.length===2){
                           //console.log(childNodes);
                           var types = childNodes[1];
                           //console.log(type);
                           try{
                             var type = types.innerHTML;
                             var mainNode = childNodes[0].childNodes;
                             var movieFormat = mainNode[2].innerHTML;
                             
                             if (type.includes("Película") && ! movieFormat.includes("1080") && !movieFormat.includes("720")){
                               var nodeWithInfo = mainNode[0];
                               //var movieNAME = nodeWithInfo.innerHTML;
                               //movieNAME = movieNAME.replace(/<font color="darkblue">/gi,"");
                               //movieNAME = movieNAME.replace(/<\/font>/gi,"");
                               //console.log(movieNAME);
                               var movieHREF = nodeWithInfo.href;

                              // var text = /\S[\s\S]*/.exec(movieName);
                               //console.log(text[0]);
                               //console.log(movieHREF);

                               getHTML(movieHREF, i, function(response2){
                                   var movieIMAGE = response2.getElementsByTagName('img');
                                   var arr2 = Array.from(movieIMAGE);
                                   var movieIMAGESOURCE = arr2[1].src;
                                   var movieA = response2.getElementsByTagName('a');
                                   var arr3 = Array.from(movieA);
                                   var movieID;
                                   
                                   var movieNAME = response2.getElementsByTagName('b');
                                   var movieFINALNAME;
                                   var arr5 = Array.from(movieNAME);
                                   
                                   for(var c=0;c<arr5.length;c++){
                                    try {
                                        var stringIncluded = arr5[c].innerHTML.toLowerCase();
                                        var comparedX = x.toLowerCase();
                                        
                                        stringIncluded = eliminarDiacriticosEs(stringIncluded);
                                        comparedX = eliminarDiacriticosEs(comparedX);
                                        //console.log(stringIncluded);
                                       // console.log(comparedX);

                                       if (stringIncluded.includes(comparedX)){
                                         movieFINALNAME = arr5[c].innerHTML;
                                       }
                                    } catch(error){
     
                                    }
                                   }
                                   
                                   for (var y=0;y<arr3.length;y++){
                                        try{
                                           var hrefDownload = arr3[y].href;
                                           if (hrefDownload.includes("tabla=peliculas&id=")){
                                               var previousREGEX = /id=([0-9]+)/gi.exec(hrefDownload)
                                               movieID = previousREGEX[1];
                                           }
                                        }catch(error){ }
                                   }
                                   
                                   
                                   var downloadURL = "http://www.mejortorrent.org/secciones.php?sec=descargas&ap=contar&tabla=peliculas&id=";
                                   var downloadURL2 = "&link_bajar=1";
                                   var craftedDownloadURL=downloadURL+movieID+downloadURL2;
                                   
                                   getHTML(craftedDownloadURL, movieFINALNAME, function(response3){
                                       
                                       var movieAA = response3.getElementsByTagName('a');
                                       var arr4 = Array.from(movieAA);
                                       var finalDownloadLINK;
                                       for (var y=0;y<arr4.length;y++){
                                        try{
                                           var hrefDownload = arr4[y].href;
                                           if (hrefDownload.includes("table=peliculas") && hrefDownload.includes(".torrent")){
                                               finalDownloadLINK = hrefDownload;
                                           }
                                        }catch(error){ }
                                       }
                                       

                                        //NOW THAT WE HAVE ALL THE INFO, LETS CREATE THE RESULTS
                                        var table = document.getElementById("meri");
                                        var row = table.insertRow(0);
                                        var img = new Image();
                                        img.src = movieIMAGESOURCE;
                                        
                                        var cell1 = row.insertCell(0);
                                        var cell2 = row.insertCell(1);
                                        var cell3 = row.insertCell(2);
                                        
                                        var formulari = document.createElement("form");
                                        formulari.setAttribute('action',finalDownloadLINK);

                                        var input = document.createElement("input");
                                        input.setAttribute('type',"submit");
                                        input.setAttribute('value',"DESCARREGAR");
                                        
                                        var newA = document.createElement("a");
                                        var linkText = document.createTextNode("DESCARREGAR");
                                        newA.appendChild(linkText);
                                        newA.title = "DESCARREGAR";
                                        newA.href = finalDownloadLINK;

                                        formulari.appendChild(input);
                                        cell1.innerHTML = movieFINALNAME;
                                        cell3.appendChild(newA);
                                        cell2.appendChild(img);
                                        infoNODE.innerHTML="";
                                 
                                   });
                                   
                               });
                               

                           }
                     
                            if (mainNODE.childNodes.length<2){
                                infoNODE.innerHTML="NO HI HA RESULTATS";
                            }
                   
                     
                       } catch(error) {
                           infoNODE.innerHTML="NO HI HA RESULTATS";
                       }
                   } 
                   }
               });
               
            }
            
            function search_mejortorrent1(){
               var mainNODE = document.getElementById("meri");
               while (mainNODE.firstChild) {
                    mainNODE.removeChild(mainNODE.firstChild);
               }
               var infoNODE = document.getElementById("info"); 
               infoNODE.innerHTML="CERCANT...tingues paciència..";
               
               var x = document.getElementById("search_mejortorrent1").value;
               document.getElementById("search_input").value="";
               var regex = /<tr[\s\S]*Peliculas/i;
               var queryURL = "https://mejortorrent1.com/?s=";
               var downloadURL = "https://mejortorrent1.com/descargar.php";
               //var queryURL = "http://www.mejortorrent.org/secciones.php?sec=buscador&valor="
               var createdQuery = queryURL+x; 
               //console.log(createdQuery);
               
               getHTML(createdQuery, "",function(response){
                   var stringui = response.documentElement.innerHTML;
                   var elements = response.getElementsByTagName('tr');
                   var arr = Array.from(elements);
                   for (var i=0; i<arr.length; i++){
                       var childNodes = arr[i].childNodes;
                       //console.log(childNodes);
                       if (childNodes[3] != null){
                           //console.log(childNodes[3]);
                           var type = childNodes[3].innerHTML;
                           if (type.includes("Peliculas") && ! type.includes("HD")){
                               var mainNode = childNodes[1].childNodes;
                               //console.log("mainNode");
                               //console.log(mainNode);
                               var nodeWithInfo = mainNode[1];
                               //console.log(nodeWithInfo);
                               var movieName = nodeWithInfo.innerHTML;
                               var movieHREF = nodeWithInfo.href;
                               //console.log(movieName);
                               var text = /\S[\s\S]*/.exec(movieName);
                               //console.log(text[0]);
                               //console.log(movieHREF);
                               
                               getHTML(movieHREF, "", function(response2){
                                   var movieTEXT = response2.documentElement.innerHTML;
                                   var movieIMAGE = response2.getElementsByTagName('img');
                                   var movieFORM = response2.getElementsByTagName('form');
                                   //console.log(movieFORM);
                                   var arr2 = Array.from(movieIMAGE);
                                   var arr3 = Array.from(movieFORM);
                                   var movieInput1Name = arr3[1][1].name;
                                   var movieInput1Value = arr3[1][1].value;
                                   var movieInput2Name = arr3[1][2].name;
                                   var movieInput2Value = arr3[1][2].value;
                                   var movieInput3Value = arr3[1][3].value;
                                   var movieNAME = arr2[1].alt;
                                   //console.log(arr2[1]);
                                   //console.log(arr2[1].alt);
                                   var movieIMAGESOURCE = arr2[1].src;
                                   
                                   
                                 //NOW THAT WE HAVE ALL THE INFO, LETS CREATE THE RESULTS
                                 var table = document.getElementById("meri");
                                 var img = new Image();
                                 img.src = movieIMAGESOURCE;
                                 var row = table.insertRow(0);
                                 var cell1 = row.insertCell(0);
                                 var cell2 = row.insertCell(1);
                                 var cell3 = row.insertCell(2);						  											  							  											  
                                 var formulari = document.createElement("form");
                                    formulari.setAttribute('method',"post");
                                    formulari.setAttribute('action',downloadURL);
                                 
                                 var input = document.createElement("input");
                                    input.setAttribute('type',"hidden");
                                    input.setAttribute('name',movieInput1Name);
                                    input.setAttribute('value',movieInput1Value);
                                 var input2 = document.createElement("input");
                                    input2.setAttribute('type',"hidden");
                                    input2.setAttribute('name',movieInput2Name);
                                    input2.setAttribute('value',movieInput2Value);
                                    
                                 var input3 = document.createElement("input");
                                    input3.setAttribute('type',"hidden");
                                    input3.setAttribute('name',"hash");
                                    input3.setAttribute('value',movieInput3Value);
                                    input3.setAttribute('id',"hash-post");
                                 
                                 var inputSUBMIT = document.createElement("input");
                                    inputSUBMIT.setAttribute('type',"submit");
                                    inputSUBMIT.setAttribute('value',"Descargar");
                                    
                                    formulari.appendChild(inputSUBMIT);
                                    formulari.appendChild(input);
                                    formulari.appendChild(input2);
                                    formulari.appendChild(input3);
                                    
                                 cell1.innerHTML = movieNAME;
                                 cell3.appendChild(formulari);
                                 cell2.appendChild(img);
                                 infoNODE.innerHTML="";
                                 
                               });
                               

                           }
                       }
                   }
                   
                   //console.log(mainNODE.childNodes);
                   if (mainNODE.childNodes.length<2){
                       infoNODE.innerHTML="NO HI HA RESULTATS";
                   }
                       
               });
               
            } 
        </script>
        <br>
        <input id="search_input" value="" />
        <input type="submit" value="Cerca MejorTorrent.ORG" name="search" onclick="search()" />
        <input id="search_mejortorrent1" value="" />
        <input type="submit" value="Cerca MejorTorrent1" name="searchMejorTOrrent" onclick="search_mejortorrent1()" />
        <br>
        <div id="info">
            
        </div>
        <div >
            <table id="meri">
               
            </table>
        </div>
        
    </body>
</html>



